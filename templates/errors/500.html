{% extends "base.html" %}

{% block title %}Error del Servidor - Spotify Picaflorino{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-red-900 via-red-700 to-orange-600 flex items-center justify-center">
    <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        
        <!-- Ilustración de error -->
        <div class="mb-8">
            <div class="relative">
                <!-- Amplificador roto -->
                <div class="w-56 h-40 mx-auto mb-6 relative">
                    <!-- Cuerpo del amplificador -->
                    <div class="w-full h-full bg-gray-900 rounded-lg shadow-2xl border-4 border-gray-700 relative overflow-hidden">
                        <!-- Pantalla rota -->
                        <div class="absolute top-4 left-4 right-4 h-16 bg-black rounded border-2 border-gray-600 flex items-center justify-center">
                            <div class="text-red-400 font-mono text-lg font-bold animate-pulse">
                                ERROR 500
                            </div>
                            <!-- Grietas en la pantalla -->
                            <div class="absolute inset-0 pointer-events-none">
                                <svg class="w-full h-full" viewBox="0 0 100 100">
                                    <path d="M20,30 L80,70" stroke="rgba(255,255,255,0.3)" stroke-width="1" fill="none"/>
                                    <path d="M60,20 L40,80" stroke="rgba(255,255,255,0.2)" stroke-width="1" fill="none"/>
                                    <path d="M10,50 L90,60" stroke="rgba(255,255,255,0.25)" stroke-width="1" fill="none"/>
                                </svg>
                            </div>
                        </div>
                        
                        <!-- Perillas y controles -->
                        <div class="absolute bottom-4 left-4 flex space-x-2">
                            <div class="w-6 h-6 bg-gray-600 rounded-full border-2 border-gray-500"></div>
                            <div class="w-6 h-6 bg-gray-600 rounded-full border-2 border-gray-500"></div>
                            <div class="w-6 h-6 bg-red-600 rounded-full border-2 border-red-500 animate-pulse"></div>
                        </div>
                        
                        <!-- LEDs de estado -->
                        <div class="absolute bottom-4 right-4 flex space-x-1">
                            <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                            <div class="w-2 h-2 bg-gray-600 rounded-full"></div>
                            <div class="w-2 h-2 bg-gray-600 rounded-full"></div>
                        </div>
                        
                        <!-- Rejilla de ventilación -->
                        <div class="absolute right-2 top-1/2 transform -translate-y-1/2">
                            <div class="grid grid-cols-4 gap-1">
                                {% for i in range(16) %}
                                    <div class="w-1 h-1 bg-gray-600 rounded-full"></div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cables desconectados -->
                    <div class="absolute -bottom-4 left-8 w-2 h-8 bg-black rounded-full transform rotate-12"></div>
                    <div class="absolute -bottom-6 left-12 w-2 h-12 bg-red-600 rounded-full transform -rotate-12"></div>
                    <div class="absolute -bottom-4 right-8 w-2 h-8 bg-gray-700 rounded-full transform rotate-45"></div>
                </div>
                
                <!-- Chispas y efectos -->
                <div class="absolute top-0 left-0 w-full h-full pointer-events-none">
                    <div class="absolute top-1/4 left-1/4 text-yellow-400 animate-ping">
                        <i class="fas fa-bolt text-lg"></i>
                    </div>
                    <div class="absolute top-1/3 right-1/4 text-orange-400 animate-ping" style="animation-delay: 0.5s;">
                        <i class="fas fa-fire text-sm"></i>
                    </div>
                    <div class="absolute bottom-1/4 left-1/3 text-red-400 animate-ping" style="animation-delay: 1s;">
                        <i class="fas fa-exclamation-triangle text-lg"></i>
                    </div>
                    <div class="absolute bottom-1/3 right-1/3 text-yellow-300 animate-ping" style="animation-delay: 1.5s;">
                        <i class="fas fa-bolt text-sm"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mensaje de error -->
        <div class="text-white space-y-6">
            <h1 class="text-6xl font-bold mb-4 text-red-200">500</h1>
            
            <h2 class="text-3xl font-semibold mb-4">
                ¡Houston, tenemos un problema!
            </h2>
            
            <p class="text-xl text-red-100 mb-8 leading-relaxed">
                Nuestros servidores están experimentando algunas dificultades técnicas. 
                El equipo de soporte ya está trabajando para restaurar la armonía.
            </p>
            
            <!-- Estado del sistema -->
            <div class="bg-black bg-opacity-30 backdrop-blur-sm rounded-2xl p-6 mb-8 border border-red-300 border-opacity-20">
                <div class="flex items-center justify-center mb-4">
                    <i class="fas fa-server text-red-400 text-2xl mr-3 animate-pulse"></i>
                    <h3 class="text-lg font-semibold">Estado del Sistema</h3>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                    <div class="flex items-center justify-between">
                        <span>Base de Datos:</span>
                        <span class="flex items-center">
                            <div class="w-2 h-2 bg-red-500 rounded-full mr-2 animate-pulse"></div>
                            Interrumpido
                        </span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span>Servidor Web:</span>
                        <span class="flex items-center">
                            <div class="w-2 h-2 bg-yellow-500 rounded-full mr-2 animate-pulse"></div>
                            Inestable
                        </span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span>Reproductor:</span>
                        <span class="flex items-center">
                            <div class="w-2 h-2 bg-red-500 rounded-full mr-2 animate-pulse"></div>
                            Sin servicio
                        </span>
                    </div>
                </div>
                
                <div class="mt-4 text-center">
                    <p class="text-red-200 text-sm">
                        <i class="fas fa-tools mr-2"></i>
                        Tiempo estimado de reparación: 5-10 minutos
                    </p>
                </div>
            </div>
            
            <!-- Botones de acción -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                <button onclick="location.reload()" 
                        class="bg-red-600 hover:bg-red-700 text-white font-semibold py-4 px-8 rounded-full transition-all duration-300 transform hover:scale-105 flex items-center">
                    <i class="fas fa-redo mr-3"></i>
                    Reintentar
                </button>
                
                <a href="{{ url_for('index') }}" 
                   class="bg-orange-600 hover:bg-orange-700 text-white font-semibold py-4 px-8 rounded-full transition-all duration-300 transform hover:scale-105 flex items-center">
                    <i class="fas fa-home mr-3"></i>
                    Ir al Inicio
                </a>
                
                <button onclick="reportError()" 
                        class="bg-transparent border-2 border-white text-white hover:bg-white hover:text-red-700 font-semibold py-4 px-8 rounded-full transition-all duration-300 flex items-center">
                    <i class="fas fa-bug mr-3"></i>
                    Reportar Error
                </button>
            </div>
            
            <!-- Información adicional -->
            <div class="mt-8 text-center">
                <details class="text-left max-w-lg mx-auto">
                    <summary class="cursor-pointer text-red-200 hover:text-white mb-4">
                        <i class="fas fa-info-circle mr-2"></i>
                        ¿Qué puedes hacer mientras tanto?
                    </summary>
                    <div class="bg-black bg-opacity-20 rounded-lg p-4 text-sm text-red-100 space-y-2">
                        <p>• Refrescar la página en unos minutos</p>
                        <p>• Verificar tu conexión a internet</p>
                        <p>• Intentar acceder más tarde</p>
                        <p>• Contactar al administrador si el error persiste</p>
                        <p>• Revisar nuestras redes sociales para actualizaciones</p>
                    </div>
                </details>
            </div>
        </div>
        
        <!-- Enlaces de contacto -->
        <div class="mt-12 text-center">
            <p class="text-red-200 mb-4">¿El problema persiste?</p>
            <div class="flex justify-center space-x-6 text-sm">
                <a href="#" onclick="reportError()" class="text-red-300 hover:text-white transition-colors duration-200">
                    <i class="fas fa-envelope mr-1"></i>
                    Contactar Soporte
                </a>
                <a href="#" class="text-red-300 hover:text-white transition-colors duration-200">
                    <i class="fas fa-phone mr-1"></i>
                    Llamar: (064) 123-456
                </a>
                <a href="#" class="text-red-300 hover:text-white transition-colors duration-200">
                    <i class="fab fa-whatsapp mr-1"></i>
                    WhatsApp Soporte
                </a>
            </div>
        </div>
        
        <!-- Código de error para soporte -->
        <div class="mt-8 text-center">
            <p class="text-red-300 text-xs">
                Código de error: <span class="font-mono bg-black bg-opacity-30 px-2 py-1 rounded" id="errorCode">SP-500-{{ moment().format('YYMMDDHHmmss') }}</span>
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Generar código de error único
    function generateErrorCode() {
        const timestamp = new Date().toISOString().replace(/[-:T.]/g, '').substring(0, 14);
        const random = Math.random().toString(36).substring(2, 6).toUpperCase();
        return `SP-500-${timestamp}-${random}`;
    }
    
    // Actualizar código de error
    document.getElementById('errorCode').textContent = generateErrorCode();
    
    // Función para reportar error
    function reportError() {
        const errorCode = document.getElementById('errorCode').textContent;
        const userAgent = navigator.userAgent;
        const timestamp = new Date().toISOString();
        const currentUrl = window.location.href;
        
        // Crear modal de reporte
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
        modal.innerHTML = `
            <div class="bg-white rounded-2xl p-8 w-full max-w-md mx-4">
                <h3 class="text-xl font-bold text-gray-900 mb-4">Reportar Error</h3>
                <form id="errorReportForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Describe qué estabas haciendo cuando ocurrió el error:
                            </label>
                            <textarea class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" 
                                      rows="3" placeholder="Ejemplo: Intentaba reproducir una canción..."></textarea>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-3 text-xs">
                            <strong>Información técnica:</strong><br>
                            Código: ${errorCode}<br>
                            URL: ${currentUrl}<br>
                            Navegador: ${userAgent.substring(0, 50)}...<br>
                            Timestamp: ${timestamp}
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="closeErrorModal()" 
                                class="px-4 py-2 text-gray-600 hover:text-gray-800">
                            Cancelar
                        </button>
                        <button type="submit" 
                                class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                            Enviar Reporte
                        </button>
                    </div>
                </form>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // Manejar envío del formulario
        document.getElementById('errorReportForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Reporte de error enviado. Gracias por tu colaboración.');
            closeErrorModal();
        });
    }
    
    function closeErrorModal() {
        const modal = document.querySelector('.fixed.inset-0.bg-black.bg-opacity-75');
        if (modal) {
            document.body.removeChild(modal);
        }
    }
    
    // Auto-refresh cada 30 segundos
    let autoRefreshInterval;
    let countdown = 30;
    
    function startAutoRefresh() {
        // Crear contador visual
        const counterDiv = document.createElement('div');
        counterDiv.className = 'fixed bottom-4 right-4 bg-black bg-opacity-50 text-white px-4 py-2 rounded-lg text-sm';
        counterDiv.innerHTML = `
            <div class="flex items-center space-x-2">
                <i class="fas fa-clock"></i>
                <span>Auto-refresco en <span id="countdown">${countdown}</span>s</span>
                <button onclick="cancelAutoRefresh()" class="ml-2 text-red-400 hover:text-red-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;
        document.body.appendChild(counterDiv);
        
        autoRefreshInterval = setInterval(() => {
            countdown--;
            const countdownElement = document.getElementById('countdown');
            if (countdownElement) {
                countdownElement.textContent = countdown;
            }
            
            if (countdown <= 0) {
                location.reload();
            }
        }, 1000);
    }
    
    function cancelAutoRefresh() {
        clearInterval(autoRefreshInterval);
        const counter = document.querySelector('.fixed.bottom-4.right-4');
        if (counter) {
            document.body.removeChild(counter);
        }
    }
    
    // Iniciar auto-refresh después de 5 segundos
    setTimeout(startAutoRefresh, 5000);
    
    // Efectos visuales adicionales
    function createSpark() {
        const spark = document.createElement('div');
        spark.className = 'absolute w-1 h-1 bg-yellow-400 rounded-full pointer-events-none';
        spark.style.left = (Math.random() * window.innerWidth) + 'px';
        spark.style.top = (Math.random() * window.innerHeight) + 'px';
        
        document.body.appendChild(spark);
        
        // Animación de chispa
        let opacity = 1;
        let size = 1;
        const interval = setInterval(() => {
            opacity -= 0.1;
            size += 0.5;
            spark.style.opacity = opacity;
            spark.style.transform = `scale(${size})`;
            
            if (opacity <= 0) {
                clearInterval(interval);
                document.body.removeChild(spark);
            }
        }, 100);
    }
    
    // Crear chispas cada 2 segundos
    setInterval(createSpark, 2000);
    
    // Efecto de parpadeo en elementos críticos
    document.addEventListener('DOMContentLoaded', function() {
        const errorElements = document.querySelectorAll('.animate-pulse');
        
        setInterval(() => {
            errorElements.forEach(element => {
                element.style.opacity = Math.random() > 0.3 ? '1' : '0.3';
            });
        }, 500);
    });
    
    // Simular progreso de reparación
    let repairProgress = 0;
    function updateRepairProgress() {
        repairProgress += Math.random() * 10;
        if (repairProgress > 100) repairProgress = 100;
        
        // Actualizar tiempo estimado basado en progreso
        const timeElement = document.querySelector('.text-red-200.text-sm');
        if (timeElement && repairProgress < 100) {
            const remainingTime = Math.ceil((100 - repairProgress) / 10);
            timeElement.innerHTML = `<i class="fas fa-tools mr-2"></i>Tiempo estimado de reparación: ${remainingTime} minutos`;
        } else if (repairProgress >= 100) {
            timeElement.innerHTML = `<i class="fas fa-check mr-2"></i>Reparación completada - Intenta refrescar la página`;
            timeElement.className = 'text-green-200 text-sm';
        }
    }
    
    // Actualizar progreso cada 15 segundos
    setInterval(updateRepairProgress, 15000);
</script>

<style>
    /* Animaciones personalizadas para el error 500 */
    @keyframes glitch {
        0% { transform: translate(0); }
        20% { transform: translate(-2px, 2px); }
        40% { transform: translate(-2px, -2px); }
        60% { transform: translate(2px, 2px); }
        80% { transform: translate(2px, -2px); }
        100% { transform: translate(0); }
    }
    
    .animate-glitch {
        animation: glitch 0.3s linear infinite;
    }
    
    /* Efecto de pantalla rota */
    .broken-screen {
        position: relative;
        overflow: hidden;
    }
    
    .broken-screen::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, 
            transparent 30%, 
            rgba(255,255,255,0.1) 32%, 
            transparent 34%,
            transparent 65%,
            rgba(255,255,255,0.1) 67%,
            transparent 69%);
        pointer-events: none;
    }
</style>
{% endblock %}